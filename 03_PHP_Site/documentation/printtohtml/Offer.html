<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<title>Offer.php</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<style type="text/css">
<!--
body {color: #000000; background-color: #ffffff; font-family: Monospaced}
pre {color: #000000; background-color: #ffffff; font-family: Monospaced}
table {color: #000000; background-color: #e9e8e2; font-family: Monospaced}
.ST0 {background-color: #e9eff8; font-family: Monospaced; font-weight: bold}
.ST2 {font-family: Monospaced; font-weight: bold}
.PHP_VARIABLE {color: #6d3206}
.ST1 {color: #009900}
.string {color: #ce7b00}
.keyword {color: #0000e6}
.heredocdelimiter {color: #6c3d03}
-->
</style>
</head>
<body>
<table width="100%"><tr><td align="center">C:\xampp\htdocs\SkyDrive\Assignment3\Offer.php</td></tr></table>
<pre>
  1 <span class="ST0">&lt;?php</span>
  2 
  3 <span class="PHP_VARIABLE">$method</span> = <span class="PHP_VARIABLE">$_SERVER</span>[<span class="string">&quot;REQUEST_METHOD&quot;</span>];
  4 <span class="keyword">if</span> (<span class="PHP_VARIABLE">$method</span> == <span class="string">&quot;POST&quot;</span>) {
  5     add_offer();
  6 } <span class="keyword">else</span> {
  7     display_addoffer_form();
  8 }
  9 
 10 <span class="keyword">function</span> display_addoffer_form() {
 11     <span class="PHP_VARIABLE">$phpself</span> = <span class="PHP_VARIABLE">$_SERVER</span>[<span class="string">&quot;PHP_SELF&quot;</span>];
 12     <span class="keyword">echo</span> <span class="heredocdelimiter">&lt;&lt;&lt;FORM</span>
 13 <span class="string">    &lt;!DOCTYPE html&gt;</span>
 14 <span class="string">&lt;html&gt;</span>
 15 <span class="string">    &lt;head&gt;&lt;title&gt;Sell your books&lt;/title&gt;</span>
 16 <span class="string">    &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;./css/style1.css&quot;/&gt;&lt;/head&gt;</span>
 17 <span class="string">    &lt;body&gt;</span>
 18 <span class="string">        &lt;div class=&quot;head&quot;&gt;</span>
 19 <span class="string">            &lt;table&gt;</span>
 20 <span class="string">                &lt;tr&gt;</span>
 21 <span class="string">                    &lt;th&gt;&lt;img src=&quot;./siteimages/stack-of-books.jpg&quot;/&gt;&lt;/th&gt;</span>
 22 <span class="string">                    &lt;td&gt;&lt;h1&gt;Illawarra Antiquarian Books&lt;/h1&gt;&lt;/td&gt;</span>
 23 <span class="string">                &lt;/tr&gt;</span>
 24 <span class="string">            &lt;/table&gt;</span>
 25 <span class="string">        &lt;/div&gt;</span>
 26 <span class="string">        &lt;div class=&quot;body&quot;&gt;</span>
 27 <span class="string">            &lt;h1&gt;See your books&lt;/h1&gt;</span>
 28 <span class="string">            &lt;p&gt;We are always interested in adding to our stock of valuable books.</span>
 29 <span class="string">                If you have rare books, first editions, historical publications that </span>
 30 <span class="string">                you wish to sell then contact us.&lt;/p&gt;</span>
 31 <span class="string">            &lt;p&gt;Supply as much detail as you can on your book, and provide an email </span>
 32 <span class="string">                address where we can contact you. We will reply with an estimate of the </span>
 33 <span class="string">                value of your book.&lt;/p&gt;</span>
 34 <span class="string">            &lt;p&gt;We will give you a final definite offer when you bring your book in for inspection.&lt;/p&gt;</span>
 35 <span class="string">            &lt;form action=&quot;</span><span class="PHP_VARIABLE">$phpself</span><span class="string">&quot; method=&quot;POST&quot;&gt;</span>
 36 <span class="string">                &lt;fieldset&gt;</span>
 37 <span class="string">                    &lt;legend&gt;&lt;h1&gt;Your book for sale&lt;/h1&gt;&lt;/legend&gt;</span>
 38 <span class="string">                    &lt;h2&gt;Your email</span>
 39 <span class="string">                    &lt;input type=&quot;text&quot; name=&quot;email&quot; size=&quot;40&quot;/&gt;&lt;/h2&gt;</span>
 40 <span class="string">                    &lt;h2&gt;Details&lt;/h2&gt;</span>
 41 <span class="string">                    &lt;textarea name=&quot;details&quot; rows=&quot;5&quot; cols=&quot;74&quot;&gt;&lt;/textarea&gt;</span>
 42 <span class="string">                    &lt;h3&gt;&lt;input type=&quot;submit&quot; value=&quot;Submit details&quot;/&gt;&lt;/h3&gt;</span>
 43 <span class="string">                &lt;/fieldset&gt;</span>
 44 <span class="string">            &lt;/form&gt;</span>
 45 <span class="string">            &lt;h3&gt;&lt;input type=&#39;button&#39; onclick=&quot;javascript:history.go(-1)&quot; value=&#39;Go Back&#39;/&gt;&lt;/h3&gt;</span>
 46 <span class="string">        &lt;/div&gt;</span>
 47 <span class="string">        &lt;div class=&quot;foot&quot;&gt;</span>
 48 <span class="string">            &lt;a href=&quot;./index.php&quot;&gt;Home&lt;/a&gt;</span>
 49 <span class="string">        &lt;/div&gt;</span>
 50 <span class="string">    &lt;/body&gt;</span>
 51 <span class="string">&lt;/html&gt;</span>
 52 <span class="heredocdelimiter">FORM</span>;
 53 }
 54 
 55 <span class="keyword">function</span> add_offer() {
 56     <span class="keyword">global</span> <span class="PHP_VARIABLE">$mysqli</span>;
 57     <span class="PHP_VARIABLE">$email</span> = <span class="PHP_VARIABLE">$_POST</span>[<span class="string">&quot;email&quot;</span>];
 58     <span class="PHP_VARIABLE">$details</span> = <span class="PHP_VARIABLE">$_POST</span>[<span class="string">&quot;details&quot;</span>];
 59     <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="PHP_VARIABLE">$email</span>) || <span class="keyword">empty</span>(<span class="PHP_VARIABLE">$details</span>)) {
 60         badinput(<span class="string">&quot; email and details are needed&quot;</span>);
 61         <span class="keyword">exit</span>;
 62     }
 63     <span class="PHP_VARIABLE">$pat</span> = <span class="string">&#39;/^[a-zA-Z0-9\s&quot;\.@-]+$/&#39;</span>;
 64     <span class="keyword">if</span> (!preg_match(<span class="PHP_VARIABLE">$pat</span>, <span class="PHP_VARIABLE">$email</span>)) {
 65         badinput(<span class="string">&quot; invalid email&quot;</span>);
 66         <span class="keyword">exit</span>;
 67     }
 68     <span class="PHP_VARIABLE">$details</span> = str_replace(<span class="string">&quot;&#39;s&quot;</span>, <span class="string">&#39;`s&#39;</span>, <span class="PHP_VARIABLE">$details</span>);
 69     <span class="PHP_VARIABLE">$details</span> = str_replace(<span class="string">&quot;&#39;v&quot;</span>, <span class="string">&#39;`v&#39;</span>, <span class="PHP_VARIABLE">$details</span>);
 70     <span class="PHP_VARIABLE">$details</span> = str_replace(<span class="string">&quot;s&#39;&quot;</span>, <span class="string">&#39;s`&#39;</span>, <span class="PHP_VARIABLE">$details</span>);
 71     <span class="PHP_VARIABLE">$details</span> = str_replace(<span class="string">&quot;&#39;m&quot;</span>, <span class="string">&#39;`m&#39;</span>, <span class="PHP_VARIABLE">$details</span>);
 72     <span class="PHP_VARIABLE">$details</span> = str_replace(<span class="string">&quot;&#39;t&quot;</span>, <span class="string">&#39;`t&#39;</span>, <span class="PHP_VARIABLE">$details</span>);
 73     <span class="PHP_VARIABLE">$timezone</span> = <span class="string">&quot;Asia/Singapore&quot;</span>;
 74     <span class="keyword">if</span> (function_exists(<span class="string">&#39;date_default_timezone_set&#39;</span>))
 75         date_default_timezone_set(<span class="PHP_VARIABLE">$timezone</span>);
 76 
 77     <span class="PHP_VARIABLE">$time</span> = date(<span class="string">&#39;Y-m-d H:i:s&#39;</span>);
 78 
 79 
 80     connectToDatabase();
 81 
 82     <span class="PHP_VARIABLE">$query</span> = <span class="string">&quot;</span><span class="string">insert into Offers values(null, &#39;</span><span class="PHP_VARIABLE">$email</span><span class="string">&#39;, &#39;</span><span class="PHP_VARIABLE">$details</span><span class="string">&#39;, &#39;</span><span class="PHP_VARIABLE">$time</span><span class="string">&#39;)</span><span class="string">&quot;</span>;
 83     <span class="PHP_VARIABLE">$mysqli</span>-&gt;query(<span class="PHP_VARIABLE">$query</span>);
 84     <span class="PHP_VARIABLE">$errorreport</span> = <span class="PHP_VARIABLE">$mysqli</span>-&gt;<span class="ST1">error</span>;
 85     <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="PHP_VARIABLE">$errorreport</span>)) {
 86         <span class="keyword">echo</span> <span class="heredocdelimiter">&lt;&lt;&lt;FAILRESPONSE</span>
 87 <span class="string">        &lt;html&gt;</span>
 88 <span class="string">            &lt;head&gt;&lt;title&gt;Failure Page&lt;/title&gt;&lt;/head&gt;</span>
 89 <span class="string">            &lt;h1&gt;Database update failed&lt;/h1&gt;</span>
 90 <span class="string">        &lt;body&gt;</span>
 91 <span class="string">            &lt;p&gt;</span><span class="PHP_VARIABLE">$errorreport</span><span class="string">.&lt;/p&gt;</span>
 92 <span class="string">                &lt;a href=&quot;./Offer.php&quot;&gt;Back&lt;/a&gt;&lt;a&gt;&lt;/a&gt;</span>
 93 <span class="string">            &lt;/body&gt;</span>
 94 <span class="string">            &lt;/html&gt;</span>
 95 <span class="heredocdelimiter">FAILRESPONSE</span>;
 96     } <span class="keyword">else</span> {
 97         <span class="keyword">echo</span> <span class="heredocdelimiter">&lt;&lt;&lt;SUCCESSRESPONSE</span>
 98 <span class="string">   &lt;html&gt;</span>
 99 <span class="string">       &lt;head&gt;&lt;title&gt;Book offer&lt;/title&gt;</span>
100 <span class="string">       &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;./css/style1.css&quot;/&gt;&lt;/head&gt;</span>
101 <span class="string">       &lt;body&gt;</span>
102 <span class="string">        &lt;div class=&quot;head&quot;&gt;</span>
103 <span class="string">            &lt;table&gt;</span>
104 <span class="string">                &lt;tr&gt;</span>
105 <span class="string">                    &lt;th&gt;&lt;img src=&quot;./siteimages/stack-of-books.jpg&quot;/&gt;&lt;/th&gt;</span>
106 <span class="string">                    &lt;td&gt;&lt;h1&gt;Illawarra Antiquarian Books&lt;/h1&gt;&lt;/td&gt;</span>
107 <span class="string">                &lt;/tr&gt;</span>
108 <span class="string">            &lt;/table&gt;</span>
109 <span class="string">        &lt;/div&gt;</span>
110 <span class="string">            &lt;div class=&quot;body&quot;&gt;</span>
111 <span class="string">                &lt;h1&gt;Thank you for your input&lt;/h1&gt;</span>
112 <span class="string">                &lt;p&gt;We will review the details of your book and get back to you if we have </span>
113 <span class="string">                might be interested in purchasing it. Please note that we cannot make a binding</span>
114 <span class="string">                offer for the book until we have inspected it at our shop.&lt;/p&gt;&lt;br/&gt;</span>
115 <span class="string">            &lt;/div&gt;</span>
116 <span class="string">            &lt;div class=&quot;foot&quot;&gt;</span>
117 <span class="string">                &lt;a href=&quot;./index.php&quot;&gt;Home&lt;/a&gt;</span>
118 <span class="string">            &lt;/div&gt;</span>
119 <span class="string">        &lt;/body&gt;</span>
120 <span class="string">    &lt;/html&gt;</span>
121 <span class="heredocdelimiter">SUCCESSRESPONSE</span>;
122 
123         <span class="PHP_VARIABLE">$mysqli</span>-&gt;close();
124     }
125 }
126 
127 <span class="keyword">function</span> badinput(<span class="PHP_VARIABLE">$msg</span>) {
128     <span class="keyword">echo</span> <span class="heredocdelimiter">&lt;&lt;&lt;BADINPUT</span>
129 <span class="string">      &lt;!DOCTYPE html&gt;</span>
130 <span class="string">&lt;html&gt;</span>
131 <span class="string">    &lt;head&gt;&lt;title&gt;Sell your books&lt;/title&gt;</span>
132 <span class="string">    &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;./css/style1.css&quot;/&gt;&lt;/head&gt;</span>
133 <span class="string">    &lt;body&gt;</span>
134 <span class="string">        &lt;div class=&quot;head&quot;&gt;</span>
135 <span class="string">            &lt;table&gt;</span>
136 <span class="string">                &lt;tr&gt;</span>
137 <span class="string">                    &lt;th&gt;&lt;img src=&quot;./siteimages/stack-of-books.jpg&quot;/&gt;&lt;/th&gt;</span>
138 <span class="string">                    &lt;td&gt;&lt;h1&gt;Illawarra Antiquarian Books&lt;/h1&gt;&lt;/td&gt;</span>
139 <span class="string">                &lt;/tr&gt;</span>
140 <span class="string">            &lt;/table&gt;</span>
141 <span class="string">        &lt;/div&gt;</span>
142 <span class="string">        &lt;div class=&quot;body&quot;&gt;</span>
143 <span class="string">            &lt;form&gt;</span>
144 <span class="string">                &lt;fieldset&gt;</span>
145 <span class="string">                    &lt;legend&gt;&lt;h1&gt;Error&lt;/h1&gt;&lt;/legend&gt;</span>
146 <span class="string">                    &lt;h2&gt;Input could not be used because </span><span class="PHP_VARIABLE">$msg</span><span class="string">.&lt;/h2&gt;</span>
147 <span class="string">                &lt;/fieldset&gt;</span>
148 <span class="string">            &lt;/form&gt;</span>
149 <span class="string">            &lt;h3&gt;&lt;input type=&#39;button&#39; onclick=&quot;javascript:history.go(-1)&quot; value=&#39;Go Back&#39;/&gt;&lt;/h3&gt;</span>
150 <span class="string">        &lt;/div&gt;</span>
151 <span class="string">        &lt;div class=&quot;foot&quot;&gt;</span>
152 <span class="string">            &lt;a href=&quot;./index.php&quot;&gt;Home&lt;/a&gt;</span>
153 <span class="string">        &lt;/div&gt;</span>
154 <span class="string">    &lt;/body&gt;</span>
155 <span class="string">&lt;/html&gt;</span>
156 <span class="heredocdelimiter">BADINPUT</span>;
157 }
158 
159 <span class="keyword">function</span> connectToDatabase() {
160     <span class="keyword">global</span> <span class="PHP_VARIABLE">$mysqli</span>;
161     <span class="PHP_VARIABLE">$mysqli</span> = <span class="keyword">new</span> mysqli(<span class="string">&#39;localhost&#39;</span>, <span class="string">&#39;root&#39;</span>, <span class="string">&#39;&#39;</span>, <span class="string">&#39;iab&#39;</span>);
162 
163     <span class="keyword">if</span> (mysqli_connect_errno()) {
164         <span class="PHP_VARIABLE">$problem</span> = mysqli_connect_error();
165         badinput(<span class="PHP_VARIABLE">$problem</span>);
166         <span class="keyword">exit</span>;
167     }
168 }
169 
170 <span class="ST2">?&gt;</span>
171 
</pre></body>
</html>
